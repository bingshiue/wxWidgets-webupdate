<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>WebUpdate: download.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">wx</a></div>
<h1>download.h</h1><a href="download_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="comment">// Name:        download.h</span>
00003 <span class="comment">// Purpose:     wxDownloadThread, wxSizeCacherThread</span>
00004 <span class="comment">// Author:      Francesco Montorsi</span>
00005 <span class="comment">// Created:     2005/07/14</span>
00006 <span class="comment">// RCS-ID:      $Id: download.h,v 1.22 2005/10/20 16:06:01 frm Exp $</span>
00007 <span class="comment">// Copyright:   (c) 2005 Francesco Montorsi</span>
00008 <span class="comment">// Licence:     wxWidgets licence</span>
00010 <span class="comment"></span>
00011 
00012 <span class="preprocessor">#ifndef _WX_DOWNLOAD_H_</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define _WX_DOWNLOAD_H_</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">// wxWidgets headers</span>
00016 <span class="preprocessor">#include "<a class="code" href="webupdatedef_8h.html">wx/webupdatedef.h</a>"</span>            <span class="comment">// for WXDLLIMPEXP_WEBUPDATE macros only</span>
00017 <span class="preprocessor">#include &lt;wx/url.h&gt;</span>
00018 <span class="preprocessor">#include &lt;wx/datetime.h&gt;</span>
00019 
00020 
00021 <span class="comment">// defined later</span>
00022 <span class="keyword">class </span>wxFileName;
00023 
00024 <span class="preprocessor">#if wxUSE_HTTPENGINE</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include &lt;wx/httpbuilder.h&gt;</span>
00026 <span class="preprocessor">#endif</span>
00027 <span class="preprocessor"></span>
00028 
00029 
00030 <span class="comment">// Some protocol utilities</span>
00031 <span class="comment">// -----------------------</span>
00032 
00035 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <span class="keywordtype">bool</span> <a class="code" href="download_8cpp.html#a3">wxIsFileProtocol</a>(<span class="keyword">const</span> wxString &amp;uri);
00036 
00039 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <span class="keywordtype">bool</span> <a class="code" href="download_8cpp.html#a4">wxIsHTTPProtocol</a>(<span class="keyword">const</span> wxString &amp;uri);
00040 
00042 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <span class="keywordtype">bool</span> <a class="code" href="download_8cpp.html#a5">wxIsWebProtocol</a>(<span class="keyword">const</span> wxString &amp;uri);
00043 
00045 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> wxFileName <a class="code" href="download_8cpp.html#a6">wxGetFileNameFromURI</a>(<span class="keyword">const</span> wxString &amp;uri);
00046 
00048 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> wxString <a class="code" href="download_8cpp.html#a7">wxMakeFileURI</a>(<span class="keyword">const</span> wxFileName &amp;fn);
00049 
00051 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> wxInputStream *<a class="code" href="download_8cpp.html#a8">wxGetInputStreamFromURI</a>(<span class="keyword">const</span> wxString &amp;uri);
00052 
00054 <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="download_8cpp.html#a9">wxGetSizeOfURI</a>(<span class="keyword">const</span> wxString &amp;uri);
00055 
00056 
00057 
00058 
00059 <span class="comment">// Events</span>
00060 <span class="comment">// ----------------------</span>
00061 
00062 <span class="comment">// this is the even sent by a wxDownloadThread class to the wxEvtHandler</span>
00063 <span class="comment">// which is given it in its constructor.</span>
00064 <a class="code" href="download_8h.html#a14">DECLARE_EXPORTED_EVENT_TYPE</a>(<a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a>, wxEVT_COMMAND_DOWNLOAD_COMPLETE, -1);
00065 
00066 <span class="comment">// this is the event sent by a wxSizeCacherThread class to the wxEvtHandler which</span>
00067 <span class="comment">// is given in its constructor.</span>
00068 <a class="code" href="download_8h.html#a14">DECLARE_EXPORTED_EVENT_TYPE</a>(<a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a>, wxEVT_COMMAND_CACHESIZE_COMPLETE, -1);
00069 
<a name="l00070"></a><a class="code" href="download_8h.html#a0">00070</a> <span class="preprocessor">#define EVT_DOWNLOAD_COMPLETE(id, func)         \</span>
00071 <span class="preprocessor">        EVT_COMMAND(id, wxEVT_COMMAND_DOWNLOAD_COMPLETE, func)</span>
00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="download_8h.html#a1">00073</a> <span class="preprocessor">#define EVT_CACHESIZE_COMPLETE(id, func)                \</span>
00074 <span class="preprocessor">        EVT_COMMAND(id, wxEVT_COMMAND_CACHESIZE_COMPLETE, func)</span>
00075 <span class="preprocessor"></span>        
00076         
<a name="l00079"></a><a class="code" href="download_8h.html#a2">00079</a> <span class="preprocessor">#define wxDT_BUF_TEMP_SIZE                              2048</span>
00080 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="download_8h.html#a3">00082</a> <span class="preprocessor">#define wxDT_QUEUE_SIZE                                 32</span>
00083 <span class="preprocessor"></span>
00084 
<a name="l00086"></a><a class="code" href="download_8h.html#a16">00086</a> <span class="keyword">enum</span> <a class="code" href="download_8h.html#a16">wxDownloadThreadStatus</a> {
00087         <a class="code" href="download_8h.html#a16a4">wxDTS_WAITING</a> = -1,
00088         <a class="code" href="download_8h.html#a16a5">wxDTS_DOWNLOADING</a>,
00089         <a class="code" href="download_8h.html#a16a6">wxDTS_COMPUTINGMD5</a>      
00090 };
00091 
00092 
00093 
<a name="l00100"></a><a class="code" href="classwxDownloadThread.html">00100</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <a class="code" href="classwxDownloadThread.html">wxDownloadThread</a> : <span class="keyword">public</span> wxThread
00101 {
00102 <span class="keyword">protected</span>:              <span class="comment">// these are written by this thread and they must be only read</span>
00103                                 <span class="comment">// by other classes; making them protected and exposing only</span>
00104                                 <span class="comment">// getters for these vars ensures that we do not need to use</span>
00105                                 <span class="comment">// mutexes...</span>
00106 
<a name="l00108"></a><a class="code" href="classwxDownloadThread.html#p0">00108</a>         wxDateTime m_dtStart;
00109 
<a name="l00111"></a><a class="code" href="classwxDownloadThread.html#p1">00111</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> m_nCurrentSize;
00112 
<a name="l00114"></a><a class="code" href="classwxDownloadThread.html#p2">00114</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> m_nFinalSize;
00115 
<a name="l00117"></a><a class="code" href="classwxDownloadThread.html#p3">00117</a>         <span class="keywordtype">bool</span> m_bSuccess;
00118 
00119 <span class="preprocessor">#if wxUSE_MD5</span>
00120 <span class="preprocessor"></span>
00124         wxString m_strComputedMD5;
00125 
00126 <span class="preprocessor">#endif</span>
00127 <span class="preprocessor"></span>
<a name="l00129"></a><a class="code" href="classwxDownloadThread.html#p4">00129</a>         <span class="keywordtype">int</span> m_nFileCount;
00130 
<a name="l00131"></a><a class="code" href="classwxDownloadThread.html#p5">00131</a>         <span class="keywordtype">bool</span> m_bReady;
00132 
00133 <span class="keyword">protected</span>:              <span class="comment">// these are vars protected by mutexes...</span>
00134 
<a name="l00137"></a><a class="code" href="classwxDownloadThread.html#p6">00137</a>         <a class="code" href="download_8h.html#a16">wxDownloadThreadStatus</a> m_nStatus;
00138 
<a name="l00140"></a><a class="code" href="classwxDownloadThread.html#p7">00140</a>         wxMutex m_mStatus;
00141 
<a name="l00143"></a><a class="code" href="classwxDownloadThread.html#p8">00143</a>         <span class="keywordtype">int</span> m_nCurrentIndex;
00144 
<a name="l00146"></a><a class="code" href="classwxDownloadThread.html#p9">00146</a>         wxMutex m_mIndex;
00147 
00148 <span class="keyword">public</span>:         <span class="comment">// to avoid setters/getters (these vars are only read by this thread;</span>
00149                         <span class="comment">// they are never written and so they are not protected with mutexes).</span>
00150 
<a name="l00152"></a><a class="code" href="classwxDownloadThread.html#o0">00152</a>         wxEvtHandler *m_pHandler;
00153 
00154 <span class="keyword">public</span>:         <span class="comment">// to avoid setters/getters</span>
00155 
<a name="l00157"></a><a class="code" href="classwxDownloadThread.html#o1">00157</a>         wxString m_strURI;
00158 
<a name="l00160"></a><a class="code" href="classwxDownloadThread.html#o2">00160</a>         wxString m_strOutput;
00161 
<a name="l00163"></a><a class="code" href="classwxDownloadThread.html#o3">00163</a>         wxString m_strMD5;
00164 
<a name="l00167"></a><a class="code" href="classwxDownloadThread.html#o4">00167</a>         wxString m_strResName;
00168 
<a name="l00171"></a><a class="code" href="classwxDownloadThread.html#o5">00171</a>         wxString m_strID;
00172 
00173 <span class="keyword">public</span>:         <span class="comment">// advanced options</span>
00174 
00175 <span class="preprocessor">#if wxUSE_HTTPENGINE</span>
00176 <span class="preprocessor"></span>
00177         <span class="keyword">static</span> wxProxySettings m_proxy;
00178 
00180         <span class="keyword">static</span> wxHTTPAuthSettings m_auth;
00181 <span class="preprocessor">#endif</span>
00182 <span class="preprocessor"></span>
00183 <span class="keyword">public</span>:
<a name="l00184"></a><a class="code" href="classwxDownloadThread.html#a0">00184</a>         <a class="code" href="installer_8h.html#a5">wxDownloadThread</a>(wxEvtHandler *dlg = NULL)
00185                 : wxThread(wxTHREAD_JOINABLE), m_pHandler(dlg)
00186                 { m_bSuccess=FALSE; m_dtStart = wxDateTime::UNow(); m_nFileCount=0; 
00187                   m_nStatus = <a class="code" href="download_8h.html#a16a4">wxDTS_WAITING</a>; m_nFinalSize = 0; m_nCurrentSize = 0; 
00188                   m_nCurrentIndex=0; m_bReady=FALSE; }
00189 
<a name="l00190"></a><a class="code" href="classwxDownloadThread.html#a1">00190</a>         <span class="keyword">virtual</span> ~<a class="code" href="classwxDownloadThread.html">wxDownloadThread</a>() {}
00191 
00195     <span class="keyword">virtual</span> <span class="keywordtype">void</span> *Entry();
00196 
00197 <span class="keyword">public</span>:         <span class="comment">// getters</span>
00198 
<a name="l00200"></a><a class="code" href="classwxDownloadThread.html#a3">00200</a>         <span class="keywordtype">bool</span> DownloadWasSuccessful()<span class="keyword"> const              </span>
00201 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_bSuccess; }
00202 
<a name="l00204"></a><a class="code" href="classwxDownloadThread.html#a4">00204</a>         <span class="keywordtype">int</span> GetDownloadCount()<span class="keyword"> const</span>
00205 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_nFileCount; }
00206 
<a name="l00209"></a><a class="code" href="classwxDownloadThread.html#a5">00209</a>         wxLongLong GetElapsedMSec()<span class="keyword"> const</span>
00210 <span class="keyword">                </span>{ wxTimeSpan t = wxDateTime::UNow() - m_dtStart; <span class="keywordflow">return</span> t.GetMilliseconds(); }
00211 
<a name="l00213"></a><a class="code" href="classwxDownloadThread.html#a6">00213</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> GetCurrDownloadedBytes()<span class="keyword"> const</span>
00214 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_nCurrentSize; }
00215 
00218         <span class="keyword">virtual</span> wxString GetDownloadSpeed() <span class="keyword">const</span>;
00219 
00221         <span class="keyword">virtual</span> wxString GetRemainingTime() <span class="keyword">const</span>;
00222 
00223 <span class="preprocessor">#if wxUSE_MD5</span>
00226 <span class="preprocessor">        wxString GetComputedMD5() const</span>
00227 <span class="preprocessor"></span>                { <span class="keywordflow">return</span> m_strComputedMD5; }
00228 
00233         <span class="keywordtype">bool</span> IsMD5Ok()<span class="keyword"> const</span>
00234 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_strMD5 == m_strComputedMD5; }
00235 <span class="preprocessor">#endif</span>
00236 <span class="preprocessor"></span>
00237 <span class="keyword">public</span>:         <span class="comment">// current status</span>
00238         
<a name="l00242"></a><a class="code" href="classwxDownloadThread.html#a9">00242</a>         <span class="keywordtype">bool</span> IsDownloading()<span class="keyword"> const</span>
00243 <span class="keyword">                </span>{ <span class="keywordflow">return</span> (IsRunning() &amp;&amp; m_nStatus == <a class="code" href="download_8h.html#a16a5">wxDTS_DOWNLOADING</a>); }
00244 
<a name="l00246"></a><a class="code" href="classwxDownloadThread.html#a10">00246</a>         <span class="keywordtype">bool</span> IsComputingMD5()<span class="keyword"> const</span>
00247 <span class="keyword">                </span>{ <span class="keywordflow">return</span> (IsRunning() &amp;&amp; m_nStatus == <a class="code" href="download_8h.html#a16a6">wxDTS_COMPUTINGMD5</a>); }
00248 
<a name="l00250"></a><a class="code" href="classwxDownloadThread.html#a11">00250</a>         <span class="keywordtype">bool</span> IsWaiting()<span class="keyword"> const </span>
00251 <span class="keyword">                </span>{ <span class="keywordflow">return</span> (IsRunning() &amp;&amp; m_nStatus == <a class="code" href="download_8h.html#a16a4">wxDTS_WAITING</a>); }
00252 
<a name="l00258"></a><a class="code" href="classwxDownloadThread.html#a12">00258</a>         <a class="code" href="download_8h.html#a16">wxDownloadThreadStatus</a> GetStatus()<span class="keyword"> const</span>
00259 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_nStatus; }
00260 
00261 <span class="keyword">public</span>:         <span class="comment">// miscellaneous</span>
00262 
<a name="l00266"></a><a class="code" href="classwxDownloadThread.html#a13">00266</a>         <span class="keywordtype">void</span> BeginNewDownload() {
00267                 wxASSERT(m_bReady &amp;&amp; !IsDownloading() &amp;&amp; !IsComputingMD5());
00268                 wxMutexLocker lock(m_mStatus);
00269                 m_nStatus = <a class="code" href="download_8h.html#a16a5">wxDTS_DOWNLOADING</a>;          
00270         }
00271 
<a name="l00273"></a><a class="code" href="classwxDownloadThread.html#a14">00273</a>         <span class="keywordtype">void</span> AbortDownload() {
00274                 wxASSERT(IsDownloading() || IsComputingMD5());
00275                 wxMutexLocker lock(m_mStatus);
00276                 m_nStatus = <a class="code" href="download_8h.html#a16a4">wxDTS_WAITING</a>;
00277         }
00278 };
00279 
00280 
00281 
<a name="l00287"></a><a class="code" href="classwxSizeCacherThread.html">00287</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> wxSizeCacherThread : <span class="keyword">public</span> wxThread
00288 {
00289 <span class="keyword">protected</span>:
00290 
<a name="l00296"></a><a class="code" href="classwxSizeCacherThread.html#p0">00296</a>         wxArrayLong *m_urlSizes;
00297 
00298 <span class="keyword">public</span>:         <span class="comment">// to avoid setters/getters (these vars are only read by this thread;</span>
00299                         <span class="comment">// they are never written and so they are not protected with mutexes).</span>
00300 
<a name="l00302"></a><a class="code" href="classwxSizeCacherThread.html#o0">00302</a>         wxEvtHandler *m_pHandler;
00303 
<a name="l00305"></a><a class="code" href="classwxSizeCacherThread.html#o1">00305</a>         wxArrayString m_urls;
00306 
00307 <span class="keyword">public</span>:
<a name="l00308"></a><a class="code" href="classwxSizeCacherThread.html#a0">00308</a>         wxSizeCacherThread(wxEvtHandler *dlg = NULL) 
00309                 : wxThread(wxTHREAD_DETACHED), m_pHandler(dlg) {}
<a name="l00310"></a><a class="code" href="classwxSizeCacherThread.html#a1">00310</a>         <span class="keyword">virtual</span> ~wxSizeCacherThread() {}
00311 
00313     <span class="keyword">virtual</span> <span class="keywordtype">void</span> *Entry();
00314     
00317     <span class="keyword">virtual</span> <span class="keywordtype">void</span> OnExit();
00318 };
00319 
00320 <span class="preprocessor">#endif // _WX_DOWNLOAD_H_</span>
00321 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 12 14:55:57 2005 for WebUpdate by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
