<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>WebUpdate: installer.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000001.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">wx</a></div>
<h1>installer.h</h1><a href="installer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="comment">// Name:        installer.h</span>
00003 <span class="comment">// Purpose:     wxWebUpdateInstaller and wxWebUpdateInstallThread</span>
00004 <span class="comment">// Author:      Francesco Montorsi</span>
00005 <span class="comment">// Created:     2005/07/14</span>
00006 <span class="comment">// RCS-ID:      $Id: installer.h,v 1.21 2005/10/20 16:06:01 frm Exp $</span>
00007 <span class="comment">// Copyright:   (c) 2005 Francesco Montorsi</span>
00008 <span class="comment">// Licence:     wxWidgets licence</span>
00010 <span class="comment"></span>
00011 
00012 <span class="preprocessor">#ifndef _WX_INSTALLER_H_</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define _WX_INSTALLER_H_</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">// wxWidgets headers</span>
00016 <span class="preprocessor">#include "<a class="code" href="webupdatedef_8h.html">wx/webupdatedef.h</a>"</span>            <span class="comment">// for WXDLLIMPEXP_WEBUPDATE macros only</span>
00017 <span class="preprocessor">#include "<a class="code" href="webupdate_8h.html">wx/webupdate.h</a>"</span>
00018 
00019 
<a name="l00021"></a><a class="code" href="installer_8h.html#a0">00021</a> <span class="preprocessor">#define wxWUI_VERSION_MAJOR                     1</span>
<a name="l00022"></a><a class="code" href="installer_8h.html#a1">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define wxWUI_VERSION_MINOR                     0</span>
<a name="l00023"></a><a class="code" href="installer_8h.html#a2">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define wxWUI_VERSION_RELEASE           0               // should always be zero (not used)</span>
<a name="l00024"></a><a class="code" href="installer_8h.html#a3">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define wxWUI_VERSION_STRING            wxT("1.0")</span>
00025 <span class="preprocessor"></span>
00026 <span class="comment">// defined later</span>
<a name="l00027"></a><a class="code" href="installer_8h.html#a5">00027</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <a class="code" href="classwxDownloadThread.html">wxDownloadThread</a>;
<a name="l00028"></a><a class="code" href="installer_8h.html#a6">00028</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <a class="code" href="classwxWebUpdateDlg.html">wxWebUpdateDlg</a>;
00029 
00030 <span class="comment">// this is the even sent by a wxDownloadThread class to the wxEvtHandler</span>
00031 <span class="comment">// which is given it in its constructor.</span>
00032 <a class="code" href="download_8h.html#a14">DECLARE_EXPORTED_EVENT_TYPE</a>(<a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a>, wxEVT_COMMAND_INSTALLATION_COMPLETE, -1);
00033 
<a name="l00034"></a><a class="code" href="installer_8h.html#a4">00034</a> <span class="preprocessor">#define EVT_INSTALLATION_COMPLETE(id, func)             \</span>
00035 <span class="preprocessor">        EVT_COMMAND(id, wxEVT_COMMAND_INSTALLATION_COMPLETE, func)</span>
00036 <span class="preprocessor"></span>
00037 
<a name="l00039"></a><a class="code" href="installer_8h.html#a12">00039</a> <span class="keyword">enum</span> <a class="code" href="installer_8h.html#a12">wxWebUpdateInstallThreadStatus</a> {
00040         <a class="code" href="installer_8h.html#a12a7">wxWUITS_WAITING</a> = -1,
00041         <a class="code" href="installer_8h.html#a12a8">wxWUITS_INSTALLING</a>
00042 };
00043 
00044 <span class="comment">// an hash map with wxString as keys and wxWebUpdateAction as values.</span>
00045 <span class="comment">// Used by wxWebUpdateInstaller.</span>
00046 <a class="code" href="installer_8h.html#a10">WX_DECLARE_STRING_HASH_MAP_WITH_DECL</a>(<a class="code" href="classwxWebUpdateAction.html">wxWebUpdateAction</a>*, wxWebUpdateActionHashMap, <span class="keyword">class</span> <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a>);
00047 
00048 <span class="comment">// used by wxWebUpdateInstaller to store the keywords to substitute in the XML webupdate script</span>
00049 <a class="code" href="installer_8h.html#a10">WX_DECLARE_STRING_HASH_MAP_WITH_DECL</a>(wxString, wxStringStringHashMap, <span class="keyword">class</span> <a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a>);
00050 
00051 
00052 
<a name="l00060"></a><a class="code" href="classwxWebUpdateInstaller.html">00060</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> : <span class="keyword">public</span> wxObject
00061 {
00062 <span class="keyword">protected</span>:
00063 
00065         <span class="keyword">static</span> <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> *m_pTheInstaller;
00066 
<a name="l00068"></a><a class="code" href="classwxWebUpdateInstaller.html#p0">00068</a>         wxWebUpdateActionHashMap m_hashActions;
00069 
<a name="l00071"></a><a class="code" href="classwxWebUpdateInstaller.html#p1">00071</a>         wxStringStringHashMap m_hashKeywords;
00072 
00073 <span class="keyword">public</span>:
<a name="l00074"></a><a class="code" href="classwxWebUpdateInstaller.html#a0">00074</a>         <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a>() 
00075                 { InitDefaultKeywords(); InitDefaultActions(); }
<a name="l00076"></a><a class="code" href="classwxWebUpdateInstaller.html#a1">00076</a>         <span class="keyword">virtual</span> ~<a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a>() 
00077                 { FreeActionHashMap(); FreeKeywords();
00078                   <span class="comment">/* user needs to delete the global wxWebUpdateInstaller object !! </span>
00079 <span class="comment">                     using  </span>
00080 <span class="comment">                             delete wxWebUpdateInstaller::Set(NULL);</span>
00081 <span class="comment">                     code in its wxApp::OnExit() function */</span> }
00082 
00083 <span class="keyword">public</span>:         <span class="comment">// single ton accessors</span>
00084 
<a name="l00086"></a><a class="code" href="classwxWebUpdateInstaller.html#e0">00086</a>     <span class="keyword">static</span> <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> *Get()
00087         { <span class="keywordflow">if</span> (!m_pTheInstaller) m_pTheInstaller = <span class="keyword">new</span> <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a>(); <span class="keywordflow">return</span> m_pTheInstaller;}
00088 
<a name="l00091"></a><a class="code" href="classwxWebUpdateInstaller.html#e1">00091</a>     <span class="keyword">static</span> <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> *Set(<a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> *res)
00092         { <a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a> *old = m_pTheInstaller; m_pTheInstaller = res; <span class="keywordflow">return</span> old; }
00093 
00094 
00095 <span class="keyword">public</span>:         <span class="comment">// global utilities</span>
00096 
00099         <span class="keywordtype">void</span> ShowErrorMsg(<span class="keyword">const</span> wxString &amp;);
00100         
00102         <span class="keywordtype">void</span> ShowNotificationMsg(<span class="keyword">const</span> wxString &amp;, <span class="keyword">const</span> wxString &amp;title = wxEmptyString);
00103 
00104 <span class="keyword">public</span>:         <span class="comment">// supported version for the local &amp; remote XML scripts</span>
00105 
<a name="l00109"></a><a class="code" href="classwxWebUpdateInstaller.html#a4">00109</a>         <a class="code" href="webupdate_8h.html#a6">wxVersion</a> GetVersion()<span class="keyword"> const</span>
00110 <span class="keyword">                </span>{ <span class="keywordflow">return</span> <a class="code" href="installer_8h.html#a3">wxWUI_VERSION_STRING</a>; }
00111                 
00113         <a class="code" href="webupdate_8h.html#a44">wxWebUpdateCheckFlag</a> VersionCheck(<span class="keyword">const</span> <a class="code" href="webupdate_8h.html#a6">wxVersion</a> &amp;v) <span class="keyword">const</span>;
00114 
00115 <span class="keyword">public</span>:         <span class="comment">// action hashmap</span>
00116 
<a name="l00120"></a><a class="code" href="classwxWebUpdateInstaller.html#a6">00120</a>         <span class="keywordtype">void</span> AddActionHandler(<a class="code" href="classwxWebUpdateAction.html">wxWebUpdateAction</a> *custom)
00121                 { <span class="keywordflow">if</span> (!custom) <span class="keywordflow">return</span>; m_hashActions[custom-&gt;<a class="code" href="classwxWebUpdateAction.html#a8">GetName</a>()] = custom; }
00122 
00128         <a class="code" href="classwxWebUpdateAction.html">wxWebUpdateAction</a> *CreateNewAction(<span class="keyword">const</span> wxString &amp;name, 
00129                 <span class="keyword">const</span> wxArrayString *propnames, <span class="keyword">const</span> wxArrayString *propvalues);
00130 
<a name="l00132"></a><a class="code" href="classwxWebUpdateInstaller.html#a8">00132</a>         wxWebUpdateActionHashMap &amp;GetActionHashMap()
00133                 { <span class="keywordflow">return</span> m_hashActions; }
00134 
00136         <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitDefaultActions();
00137         
00139         <span class="keyword">virtual</span> <span class="keywordtype">void</span> FreeActionHashMap();
00140 
00141 
00142 <span class="keyword">public</span>:         <span class="comment">// keywords hashmap</span>
00143 
<a name="l00145"></a><a class="code" href="classwxWebUpdateInstaller.html#a11">00145</a>         wxStringStringHashMap &amp;GetKeywords()
00146                 { <span class="keywordflow">return</span> m_hashKeywords; }
00147 
<a name="l00150"></a><a class="code" href="classwxWebUpdateInstaller.html#a12">00150</a>         wxString GetKeywordValue(<span class="keyword">const</span> wxString &amp;name)
00151                 { <span class="keywordflow">return</span> m_hashKeywords[name]; }
00152 
<a name="l00155"></a><a class="code" href="classwxWebUpdateInstaller.html#a13">00155</a>         <span class="keywordtype">void</span> SetKeywordValue(<span class="keyword">const</span> wxString &amp;name, <span class="keyword">const</span> wxString &amp;val)
00156                 { m_hashKeywords[name] = val; }
00157 
00159         wxString DoKeywordSubstitution(<span class="keyword">const</span> wxString &amp;str);
00160 
00163         wxString DoPathSubstitution(<span class="keyword">const</span> wxString &amp;str);
00164         
<a name="l00166"></a><a class="code" href="classwxWebUpdateInstaller.html#a16">00166</a>         wxString DoSubstitution(<span class="keyword">const</span> wxString &amp;str)
00167                 { <span class="keywordflow">return</span> DoPathSubstitution(DoKeywordSubstitution(str)); }
00168                 
00173         <span class="keywordtype">int</span> ParsePairValueList(<span class="keyword">const</span> wxString &amp;str, wxArrayString &amp;names, wxArrayString &amp;values);
00174 
00176         <span class="keyword">virtual</span> <span class="keywordtype">void</span> InitDefaultKeywords();
00177         
00182         <span class="keyword">virtual</span> <span class="keywordtype">void</span> FreeKeywords();
00183 
00184 <span class="keyword">private</span>:
00185         DECLARE_CLASS(<a class="code" href="classwxWebUpdateInstaller.html">wxWebUpdateInstaller</a>)
00186 };
00187 
00188 
<a name="l00190"></a><a class="code" href="classwxWebUpdateInstallThread.html">00190</a> <span class="keyword">class </span><a class="code" href="webupdatedef_8h.html#a3">WXDLLIMPEXP_WEBUPDATE</a> wxWebUpdateInstallThread : <span class="keyword">public</span> wxThread
00191 {
00192 <span class="keyword">protected</span>:              <span class="comment">// these are written by this thread and they must be only read</span>
00193                                 <span class="comment">// by other classes; making them protected and exposing only</span>
00194                                 <span class="comment">// getters for these vars ensures that we do not need to use</span>
00195                                 <span class="comment">// mutexes...</span>
00196         
<a name="l00198"></a><a class="code" href="classwxWebUpdateInstallThread.html#p0">00198</a>         <span class="keywordtype">bool</span> m_bSuccess;
00199 
<a name="l00201"></a><a class="code" href="classwxWebUpdateInstallThread.html#p1">00201</a>         <span class="keywordtype">int</span> m_nInstallationCount;
00202 
00203 <span class="keyword">public</span>:         <span class="comment">// to avoid setters/getters (these vars are only read by this thread;</span>
00204                         <span class="comment">// they are never written and so they are not protected with mutexes).</span>
00205 
<a name="l00207"></a><a class="code" href="classwxWebUpdateInstallThread.html#o0">00207</a>         wxEvtHandler *m_pHandler;
00208 
<a name="l00210"></a><a class="code" href="classwxWebUpdateInstallThread.html#o1">00210</a>         wxString m_strUpdateFile;
00211 
<a name="l00215"></a><a class="code" href="classwxWebUpdateInstallThread.html#o2">00215</a>         <a class="code" href="classwxWebUpdateDownload.html">wxWebUpdateDownload</a> *m_pDownload;
00216 
00217 <span class="keyword">protected</span>:              <span class="comment">// these are vars protected by mutexes...</span>
00218 
<a name="l00221"></a><a class="code" href="classwxWebUpdateInstallThread.html#p2">00221</a>         <a class="code" href="installer_8h.html#a12">wxWebUpdateInstallThreadStatus</a> m_nStatus;
00222 
<a name="l00224"></a><a class="code" href="classwxWebUpdateInstallThread.html#p3">00224</a>         wxMutex m_mStatus;
00225 
<a name="l00227"></a><a class="code" href="classwxWebUpdateInstallThread.html#p4">00227</a>         <span class="keywordtype">int</span> m_nCurrentIndex;
00228 
00229 <span class="keyword">public</span>:
<a name="l00230"></a><a class="code" href="classwxWebUpdateInstallThread.html#a0">00230</a>         wxWebUpdateInstallThread(wxEvtHandler *dlg = NULL)
00231                 : wxThread(wxTHREAD_JOINABLE), m_pHandler(dlg)
00232                 { m_bSuccess=TRUE; m_nInstallationCount=0; m_nCurrentIndex=0;
00233                   m_nStatus = <a class="code" href="installer_8h.html#a12a7">wxWUITS_WAITING</a>; m_pDownload=NULL; }
00234 
<a name="l00235"></a><a class="code" href="classwxWebUpdateInstallThread.html#a1">00235</a>         <span class="keyword">virtual</span> ~wxWebUpdateInstallThread() {}
00236 
00237 
00239     <span class="keyword">virtual</span> <span class="keywordtype">void</span> *Entry();
00240 
00241 
00242 <span class="keyword">public</span>:         <span class="comment">// current status</span>
00243         
<a name="l00245"></a><a class="code" href="classwxWebUpdateInstallThread.html#a3">00245</a>         <span class="keywordtype">bool</span> IsInstalling()<span class="keyword"> const</span>
00246 <span class="keyword">                </span>{ <span class="keywordflow">return</span> (IsRunning() &amp;&amp; m_nStatus == <a class="code" href="installer_8h.html#a12a8">wxWUITS_INSTALLING</a>); }
00247 
<a name="l00249"></a><a class="code" href="classwxWebUpdateInstallThread.html#a4">00249</a>         <span class="keywordtype">bool</span> IsWaiting()<span class="keyword"> const </span>
00250 <span class="keyword">                </span>{ <span class="keywordflow">return</span> (IsRunning() &amp;&amp; m_nStatus == <a class="code" href="installer_8h.html#a12a7">wxWUITS_WAITING</a>); }
00251 
<a name="l00257"></a><a class="code" href="classwxWebUpdateInstallThread.html#a5">00257</a>         <a class="code" href="installer_8h.html#a12">wxWebUpdateInstallThreadStatus</a> GetStatus()<span class="keyword"> const</span>
00258 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_nStatus; }
00259 
00260 <span class="keyword">public</span>:         <span class="comment">// miscellaneous</span>
00261 
<a name="l00264"></a><a class="code" href="classwxWebUpdateInstallThread.html#a6">00264</a>         <span class="keywordtype">void</span> BeginNewInstall() {
00265                 wxASSERT(!IsInstalling());
00266                 wxMutexLocker lock(m_mStatus);
00267                 m_nStatus = <a class="code" href="installer_8h.html#a12a8">wxWUITS_INSTALLING</a>;
00268         }
00269 
<a name="l00271"></a><a class="code" href="classwxWebUpdateInstallThread.html#a7">00271</a>         <span class="keywordtype">void</span> AbortInstall() {
00272                 wxASSERT(IsInstalling());
00273                 wxMutexLocker lock(m_mStatus);
00274                 m_nStatus = <a class="code" href="installer_8h.html#a12a7">wxWUITS_WAITING</a>;
00275         }
00276 
<a name="l00278"></a><a class="code" href="classwxWebUpdateInstallThread.html#a8">00278</a>         <span class="keywordtype">bool</span> InstallationWasSuccessful()<span class="keyword"> const          </span>
00279 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_bSuccess; }
00280 
<a name="l00282"></a><a class="code" href="classwxWebUpdateInstallThread.html#a9">00282</a>         <span class="keywordtype">int</span> GetInstallationCount()<span class="keyword"> const</span>
00283 <span class="keyword">                </span>{ <span class="keywordflow">return</span> m_nInstallationCount; }
00284 };
00285 
00286 
00287 <span class="preprocessor">#endif // _WX_INSTALLER_H_</span>
00288 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Nov 12 14:55:57 2005 for WebUpdate by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
